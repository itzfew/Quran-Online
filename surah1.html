<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Kareem (Ar)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Cairo&family=El+Messiri&family=Harmattan&family=Lateef&family=Scheherazade+New&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Amiri', serif;
            direction: rtl;
            margin: 0;
            padding: 0;
            transition: all 0.3s ease;
        }
        .settings-container {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        .settings-item {
            cursor: pointer;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 50%;
            margin: 5px;
            display: inline-block;
        }
        .settings-item:hover {
            background: #ddd;
        }
        .header {
            text-align: center;
            padding: 20px;
            position: relative;
        }
        .arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 24px;
        }
        .arrow-left { left: 20px; }
        .arrow-right { right: 20px; }
        .first-verse, .verse {
            margin: 20px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .arabic-text {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .translation-text, .urdu-text, .hindi-text, .chinese-text, .bengali-text, .persian-text, .turkish-text {
            font-size: 1em;
            color: #34495e;
            margin: 5px 0;
        }
        .verse-number {
            display: inline-block;
            margin-right: 10px;
            font-size: 0.8em;
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 50%;
        }
        .share-btn, .view-btn {
            display: none;
            margin: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .share-btn { background: #27ae60; color: white; }
        .view-btn { background: #3498db; color: white; }
        .selected .share-btn, .selected .view-btn {
            display: inline-block;
        }
        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            padding: 10px;
            cursor: pointer;
        }
        .dark-mode {
            background: #2c3e50;
            color: #ecf0f1;
        }
        .dark-mode .verse, .dark-mode .first-verse {
            background: #34495e;
        }
        .settings-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }
        .settings-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            margin: 50px auto;
        }
        .settings-content h2 {
            margin-top: 0;
        }
        .settings-content select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .close-settings {
            float: right;
            cursor: pointer;
            font-size: 24px;
        }
        .translation-option {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="settings-container">
        <div class="settings-item" onclick="openSettings()">
            <i class="fas fa-cog"></i>
        </div>
        <div class="settings-item" onclick="toggleTheme()">
            <i class="fas fa-adjust"></i>
        </div>
        <div class="settings-item" onclick="changeTextSize(1)">
            <i class="fas fa-plus"></i>
        </div>
        <div class="settings-item" onclick="changeTextSize(-1)">
            <i class="fas fa-minus"></i>
        </div>
        <div class="settings-item" onclick="navigateToWordToWord()">
            <i class="fas fa-brands fa-fire"></i>
        </div>
        <div class="settings-item" onclick="navigateToRead()">
            <i class="fas fa-book-open"></i>
        </div>
    </div>

    <div class="settings-page" id="settings-page">
        <div class="settings-content">
            <span class="close-settings" onclick="closeSettings()">Ã—</span>
            <h2>Settings</h2>
            <label>Translations (Max 4):</label>
            <div id="translation-options">
                <div class="translation-option">
                    <select class="language-select" onchange="updateIdentifierOptions(this)">
                        <option value="">Select Language</option>
                        <option value="ar">Ar - Arabic</option>
                        <option value="en">En - English</option>
                        <option value="ur">Ur - Urdu</option>
                        <option value="hi">Hi - Hindi</option>
                        <option value="zh">Zh - Chinese</option>
                        <option value="bn">Bn - Bengali</option>
                        <option value="fa">Fa - Persian</option>
                        <option value="tr">Tr - Turkish</option>
                    </select>
                    <select class="identifier-select">
                        <option value="">Select Translation</option>
                    </select>
                </div>
            </div>
            <button onclick="addTranslationOption()">Add Translation</button>
            <button onclick="saveSettings()">Save Settings</button>
        </div>
    </div>

    <div class="header">
        <i class="fas fa-arrow-left arrow arrow-left" onclick="navigateSurah(1)"></i>
        <div id="surah-heading" class="surah-heading"></div>
        <i class="fas fa-arrow-right arrow arrow-right" onclick="navigateSurah(-1)"></i>
    </div>

    <div id="first-verse" class="first-verse"></div>
    <div id="content"></div>

    <button class="back-to-top" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        const translationMap = {
            ar: [
                { value: 'ar.alafasy', label: 'Arabic (Alafasy)', default: true },
                { value: 'quran-uthmani', label: 'Arabic (Uthmani)' }
            ],
            en: [
                { value: 'en.ahmedali', label: 'English (Ahmed Ali)', default: true },
                { value: 'en.asad', label: 'English (Asad)' },
                { value: 'en.pickthall', label: 'English (Pickthall)' }
            ],
            ur: [
                { value: 'ur.qadri', label: 'Urdu (Qadri)', default: true },
                { value: 'ur.jalandhry', label: 'Urdu (Jalandhry)' }
            ],
            hi: [
                { value: 'hi.hindi', label: 'Hindi', default: true }
            ],
            zh: [
                { value: 'zh.majian', label: 'Chinese (Ma Jian)', default: true }
            ],
            bn: [
                { value: 'bn.bengali', label: 'Bengali', default: true }
            ],
            fa: [
                { value: 'fa.ansarian', label: 'Persian (Ansarian)', default: true }
            ],
            tr: [
                { value: 'tr.diyanet', label: 'Turkish (Diyanet)', default: true }
            ]
        };

        document.addEventListener('DOMContentLoaded', () => {
            const darkMode = localStorage.getItem('darkMode') === 'true';
            const textSize = localStorage.getItem('textSize') || '18';
            const savedTranslations = JSON.parse(localStorage.getItem('translations')) || [
                'ar.alafasy', 'en.ahmedali', 'ur.qadri', 'hi.hindi'
            ];
            
            if (darkMode) {
                document.body.classList.add('dark-mode');
            }
            document.body.style.fontSize = textSize + 'px';
            
            loadSavedTranslations(savedTranslations);
            const index = getQueryParam('index') || 1;
            fetchSurah(index);
            displayHistory();
        });

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        function loadSavedTranslations(translations) {
            const container = document.getElementById('translation-options');
            container.innerHTML = '';
            translations.forEach(identifier => {
                const [lang, id] = identifier.split('.');
                const optionDiv = document.createElement('div');
                optionDiv.classList.add('translation-option');
                optionDiv.innerHTML = `
                    <select class="language-select" onchange="updateIdentifierOptions(this)">
                        <option value="">Select Language</option>
                        <option value="ar" ${lang === 'ar' ? 'selected' : ''}>Ar - Arabic</option>
                        <option value="en" ${lang === 'en' ? 'selected' : ''}>En - English</option>
                        <option value="ur" ${lang === 'ur' ? 'selected' : ''}>Ur - Urdu</option>
                        <option value="hi" ${lang === 'hi' ? 'selected' : ''}>Hi - Hindi</option>
                        <option value="zh" ${lang === 'zh' ? 'selected' : ''}>Zh - Chinese</option>
                        <option value="bn" ${lang === 'bn' ? 'selected' : ''}>Bn - Bengali</option>
                        <option value="fa" ${lang === 'fa' ? 'selected' : ''}>Fa - Persian</option>
                        <option value="tr" ${lang === 'tr' ? 'selected' : ''}>Tr - Turkish</option>
                    </select>
                    <select class="identifier-select">
                        <option value="">Select Translation</option>
                        ${translationMap[lang].map(t => `<option value="${t.value}" ${t.value === identifier ? 'selected' : ''}>${t.label}</option>`).join('')}
                    </select>
                `;
                container.appendChild(optionDiv);
            });
        }

        function updateIdentifierOptions(select) {
            const lang = select.value;
            const identifierSelect = select.nextElementSibling;
            identifierSelect.innerHTML = '<option value="">Select Translation</option>';
            if (lang && translationMap[lang]) {
                translationMap[lang].forEach(t => {
                    const option = document.createElement('option');
                    option.value = t.value;
                    option.text = t.label;
                    if (t.default) option.selected = true;
                    identifierSelect.appendChild(option);
                });
            }
        }

        function addTranslationOption() {
            const options = document.querySelectorAll('.translation-option');
            if (options.length >= 4) {
                alert('Maximum 4 translations can be selected.');
                return;
            }
            const optionDiv = document.createElement('div');
            optionDiv.classList.add('translation-option');
            optionDiv.innerHTML = `
                <select class="language-select" onchange="updateIdentifierOptions(this)">
                    <option value="">Select Language</option>
                    <option value="ar">Ar - Arabic</option>
                    <option value="en">En - English</option>
                    <option value="ur">Ur - Urdu</option>
                    <option value="hi">Hi - Hindi</option>
                    <option value="zh">Zh - Chinese</option>
                    <option value="bn">Bn - Bengali</option>
                    <option value="fa">Fa - Persian</option>
                    <option value="tr">Tr - Turkish</option>
                </select>
                <select class="identifier-select">
                    <option value="">Select Translation</option>
                </select>
            `;
            document.getElementById('translation-options').appendChild(optionDiv);
        }

        async function fetchSurah(index) {
            const translations = JSON.parse(localStorage.getItem('translations')) || [
                'ar.alafasy', 'en.ahmedali', 'ur.qadri', 'hi.hindi'
            ];
            const editionString = translations.join(',');
            try {
                const response = await fetch(`http://api.alquran.cloud/v1/surah/${index}/editions/${editionString}`);
                const data = await response.json();
                displaySurah(data.data, index);
            } catch (error) {
                console.error('Error fetching surah:', error);
            }
        }

        function displaySurah(surahData, index) {
            const surahHeading = document.getElementById('surah-heading');
            const firstVerse = document.getElementById('first-verse');
            const content = document.getElementById('content');

            surahHeading.innerText = surahData[0].name;
            firstVerse.innerText = surahData[0].ayahs[0]?.text || '';
            content.innerHTML = '';

            const maxAyahs = Math.max(...surahData.map(d => d.ayahs.length));
            for (let i = 1; i < maxAyahs; i++) {
                const verseDiv = document.createElement('div');
                verseDiv.classList.add('verse');
                verseDiv.setAttribute('id', `verse-${i}`);

                let verseContent = '';
                surahData.forEach(edition => {
                    const verse = edition.ayahs[i] || { text: '' };
                    const langClass = {
                        'ar.alafasy': 'arabic-text',
                        'quran-uthmani': 'arabic-text',
                        'en.ahmedali': 'translation-text',
                        'en.asad': 'translation-text',
                        'en.pickthall': 'translation-text',
                        'ur.qadri': 'urdu-text',
                        'ur.jalandhry': 'urdu-text',
                        'hi.hindi': 'hindi-text',
                        'zh.majian': 'chinese-text',
                        'bn.bengali': 'bengali-text',
                        'fa.ansarian': 'persian-text',
                        'tr.diyanet': 'turkish-text'
                    }[edition.identifier] || 'translation-text';
                    verseContent += `<div class="${langClass}">${verse.text} <span class="verse-number">${i}</span></div>`;
                });

                verseContent += `
                    <button class="share-btn" onclick="shareVerse(${i})">Share</button>
                    <button class="view-btn" onclick="viewVerse(${i})">View</button>
                `;
                verseDiv.innerHTML = verseContent;
                verseDiv.onclick = () => toggleHighlight(i);
                content.appendChild(verseDiv);
            }
        }

        function toggleHighlight(verseId) {
            const allVerses = document.querySelectorAll('.verse');
            allVerses.forEach(verse => {
                verse.classList.remove('selected');
                const shareButton = verse.querySelector('.share-btn');
                const viewButton = verse.querySelector('.view-btn');
                if (shareButton) shareButton.style.display = 'none';
                if (viewButton) viewButton.style.display = 'none';
            });

            const verseElement = document.getElementById(`verse-${verseId}`);
            verseElement.classList.add('selected');
            const shareButton = verseElement.querySelector('.share-btn');
            const viewButton = verseElement.querySelector('.view-btn');
            if (shareButton) shareButton.style.display = 'inline-block';
            if (viewButton) viewButton.style.display = 'inline-block';
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDark);
        }

        function changeTextSize(increment) {
            const newSize = parseInt(document.body.style.fontSize) + increment;
            document.body.style.fontSize = newSize + 'px';
            localStorage.setItem('textSize', newSize);
        }

        function openSettings() {
            document.getElementById('settings-page').style.display = 'block';
        }

        function closeSettings() {
            document.getElementById('settings-page').style.display = 'none';
        }

        function saveSettings() {
            const identifierSelects = document.querySelectorAll('.identifier-select');
            const selectedTranslations = Array.from(identifierSelects)
                .map(select => select.value)
                .filter(value => value);
            if (selectedTranslations.length > 4) {
                alert('Maximum 4 translations can be selected.');
                return;
            }
            if (selectedTranslations.length === 0) {
                alert('Please select at least one translation.');
                return;
            }
            localStorage.setItem('translations', JSON.stringify(selectedTranslations));
            closeSettings();
            window.location.reload();
        }

        let currentSurahIndex = 1;

        function navigateSurah(direction) {
            currentSurahIndex += direction;
            if (currentSurahIndex < 1) currentSurahIndex = 1;
            else if (currentSurahIndex > 114) currentSurahIndex = 114;

            const newUrl = `?index=${currentSurahIndex}`;
            window.history.pushState({ path: newUrl }, '', newUrl);
            fetchSurah(currentSurahIndex);
        }

        function shareVerse(verseId) {
            const verseText = document.getElementById(`verse-${verseId}`).innerText;
            if (navigator.share) {
                navigator.share({
                    title: 'Quran Verse',
                    text: verseText,
                    url: window.location.href
                }).catch((error) => console.log('Error sharing: ', error));
            } else {
                navigator.clipboard.writeText(verseText).then(() => {
                    alert('Verse copied to clipboard!');
                }).catch((error) => {
                    console.log('Error copying to clipboard: ', error);
                });
            }
        }

        function viewVerse(verseId) {
            const surahIndex = getQueryParam('index') || 1;
            window.location.href = `verse.html?surah=${surahIndex}&verse=${verseId}`;
        }

        function navigateToWordToWord() {
            const surahIndex = getQueryParam('index') || currentSurahIndex;
            window.location.href = `wordtoword.html?index=${surahIndex}#1`;
        }

        function navigateToRead() {
            const surahIndex = getQueryParam('index') || currentSurahIndex;
            window.location.href = `read?surah=${surahIndex}&page=1`;
        }

        function displayHistory() {
            // Placeholder for history functionality
        }
    </script>
</body>
</html>
